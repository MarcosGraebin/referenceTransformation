#include "SingleLib.h"

// Lookup table to avoid the use of math.h, that has a float input in the specific fixed-point format
const uint16_t cos_16[2881] = {16384,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,16383,
16382,16382,16382,16382,16382,16382,16382,16382,16381,16381,16381,16381,16381,16381,16381,16380,16380,16380,16380,16380,
16379,16379,16379,16379,16379,16378,16378,16378,16378,16377,16377,16377,16377,16376,16376,16376,16376,16375,16375,16375,
16374,16374,16374,16374,16373,16373,16373,16372,16372,16372,16371,16371,16371,16370,16370,16369,16369,16369,16368,16368,
16368,16367,16367,16366,16366,16365,16365,16365,16364,16364,16363,16363,16362,16362,16362,16361,16361,16360,16360,16359,
16359,16358,16358,16357,16357,16356,16356,16355,16355,16354,16353,16353,16352,16352,16351,16351,16350,16350,16349,16348,
16348,16347,16347,16346,16345,16345,16344,16344,16343,16342,16342,16341,16340,16340,16339,16338,16338,16337,16336,16336,
16335,16334,16334,16333,16332,16332,16331,16330,16329,16329,16328,16327,16326,16326,16325,16324,16323,16323,16322,16321,
16320,16320,16319,16318,16317,16316,16316,16315,16314,16313,16312,16311,16311,16310,16309,16308,16307,16306,16305,16305,
16304,16303,16302,16301,16300,16299,16298,16297,16297,16296,16295,16294,16293,16292,16291,16290,16289,16288,16287,16286,
16285,16284,16283,16282,16281,16280,16279,16278,16277,16276,16275,16274,16273,16272,16271,16270,16269,16268,16267,16266,
16265,16264,16262,16261,16260,16259,16258,16257,16256,16255,16254,16253,16251,16250,16249,16248,16247,16246,16244,16243,
16242,16241,16240,16239,16237,16236,16235,16234,16233,16231,16230,16229,16228,16227,16225,16224,16223,16222,16220,16219,
16218,16217,16215,16214,16213,16211,16210,16209,16207,16206,16205,16204,16202,16201,16200,16198,16197,16196,16194,16193,
16191,16190,16189,16187,16186,16185,16183,16182,16180,16179,16178,16176,16175,16173,16172,16170,16169,16168,16166,16165,
16163,16162,16160,16159,16157,16156,16154,16153,16151,16150,16148,16147,16145,16144,16142,16141,16139,16138,16136,16135,
16133,16131,16130,16128,16127,16125,16124,16122,16120,16119,16117,16116,16114,16112,16111,16109,16108,16106,16104,16103,
16101,16099,16098,16096,16094,16093,16091,16089,16088,16086,16084,16082,16081,16079,16077,16076,16074,16072,16070,16069,
16067,16065,16063,16062,16060,16058,16056,16055,16053,16051,16049,16047,16046,16044,16042,16040,16038,16037,16035,16033,
16031,16029,16027,16025,16024,16022,16020,16018,16016,16014,16012,16010,16009,16007,16005,16003,16001,15999,15997,15995,
15993,15991,15989,15987,15985,15983,15981,15980,15978,15976,15974,15972,15970,15968,15966,15964,15962,15960,15958,15956,
15953,15951,15949,15947,15945,15943,15941,15939,15937,15935,15933,15931,15929,15927,15925,15922,15920,15918,15916,15914,
15912,15910,15908,15905,15903,15901,15899,15897,15895,15892,15890,15888,15886,15884,15882,15879,15877,15875,15873,15871,
15868,15866,15864,15862,15859,15857,15855,15853,15850,15848,15846,15844,15841,15839,15837,15834,15832,15830,15828,15825,
15823,15821,15818,15816,15814,15811,15809,15807,15804,15802,15800,15797,15795,15792,15790,15788,15785,15783,15780,15778,
15776,15773,15771,15768,15766,15764,15761,15759,15756,15754,15751,15749,15746,15744,15741,15739,15736,15734,15731,15729,
15726,15724,15721,15719,15716,15714,15711,15709,15706,15704,15701,15699,15696,15693,15691,15688,15686,15683,15681,15678,
15675,15673,15670,15668,15665,15662,15660,15657,15654,15652,15649,15647,15644,15641,15639,15636,15633,15631,15628,15625,
15623,15620,15617,15614,15612,15609,15606,15604,15601,15598,15595,15593,15590,15587,15584,15582,15579,15576,15573,15571,
15568,15565,15562,15559,15557,15554,15551,15548,15545,15542,15540,15537,15534,15531,15528,15525,15523,15520,15517,15514,
15511,15508,15505,15502,15500,15497,15494,15491,15488,15485,15482,15479,15476,15473,15470,15467,15465,15462,15459,15456,
15453,15450,15447,15444,15441,15438,15435,15432,15429,15426,15423,15420,15417,15414,15411,15408,15405,15402,15398,15395,
15392,15389,15386,15383,15380,15377,15374,15371,15368,15365,15362,15358,15355,15352,15349,15346,15343,15340,15337,15333,
15330,15327,15324,15321,15318,15314,15311,15308,15305,15302,15298,15295,15292,15289,15286,15282,15279,15276,15273,15270,
15266,15263,15260,15257,15253,15250,15247,15243,15240,15237,15234,15230,15227,15224,15220,15217,15214,15210,15207,15204,
15201,15197,15194,15190,15187,15184,15180,15177,15174,15170,15167,15164,15160,15157,15153,15150,15147,15143,15140,15136,
15133,15129,15126,15123,15119,15116,15112,15109,15105,15102,15098,15095,15092,15088,15085,15081,15078,15074,15071,15067,
15064,15060,15057,15053,15049,15046,15042,15039,15035,15032,15028,15025,15021,15017,15014,15010,15007,15003,15000,14996,
14992,14989,14985,14982,14978,14974,14971,14967,14963,14960,14956,14952,14949,14945,14941,14938,14934,14930,14927,14923,
14919,14916,14912,14908,14905,14901,14897,14893,14890,14886,14882,14879,14875,14871,14867,14864,14860,14856,14852,14848,
14845,14841,14837,14833,14830,14826,14822,14818,14814,14810,14807,14803,14799,14795,14791,14787,14784,14780,14776,14772,
14768,14764,14760,14757,14753,14749,14745,14741,14737,14733,14729,14725,14721,14717,14714,14710,14706,14702,14698,14694,
14690,14686,14682,14678,14674,14670,14666,14662,14658,14654,14650,14646,14642,14638,14634,14630,14626,14622,14618,14614,
14610,14606,14602,14598,14594,14590,14586,14581,14577,14573,14569,14565,14561,14557,14553,14549,14545,14541,14536,14532,
14528,14524,14520,14516,14512,14507,14503,14499,14495,14491,14487,14482,14478,14474,14470,14466,14462,14457,14453,14449,
14445,14440,14436,14432,14428,14424,14419,14415,14411,14407,14402,14398,14394,14390,14385,14381,14377,14372,14368,14364,
14359,14355,14351,14347,14342,14338,14334,14329,14325,14321,14316,14312,14308,14303,14299,14294,14290,14286,14281,14277,
14273,14268,14264,14259,14255,14251,14246,14242,14237,14233,14229,14224,14220,14215,14211,14206,14202,14197,14193,14188,
14184,14180,14175,14171,14166,14162,14157,14153,14148,14144,14139,14135,14130,14125,14121,14116,14112,14107,14103,14098,
14094,14089,14085,14080,14075,14071,14066,14062,14057,14053,14048,14043,14039,14034,14030,14025,14020,14016,14011,14006,
14002,13997,13992,13988,13983,13978,13974,13969,13964,13960,13955,13950,13946,13941,13936,13932,13927,13922,13918,13913,
13908,13903,13899,13894,13889,13884,13880,13875,13870,13865,13861,13856,13851,13846,13842,13837,13832,13827,13822,13818,
13813,13808,13803,13798,13794,13789,13784,13779,13774,13769,13765,13760,13755,13750,13745,13740,13735,13731,13726,13721,
13716,13711,13706,13701,13696,13691,13686,13682,13677,13672,13667,13662,13657,13652,13647,13642,13637,13632,13627,13622,
13617,13612,13607,13602,13597,13592,13587,13582,13577,13572,13567,13562,13557,13552,13547,13542,13537,13532,13527,13522,
13517,13512,13507,13502,13497,13492,13487,13482,13477,13472,13466,13461,13456,13451,13446,13441,13436,13431,13426,13420,
13415,13410,13405,13400,13395,13390,13385,13379,13374,13369,13364,13359,13354,13348,13343,13338,13333,13328,13322,13317,
13312,13307,13302,13296,13291,13286,13281,13275,13270,13265,13260,13254,13249,13244,13239,13233,13228,13223,13218,13212,
13207,13202,13196,13191,13186,13181,13175,13170,13165,13159,13154,13149,13143,13138,13133,13127,13122,13117,13111,13106,
13100,13095,13090,13084,13079,13074,13068,13063,13057,13052,13047,13041,13036,13030,13025,13020,13014,13009,13003,12998,
12992,12987,12981,12976,12971,12965,12960,12954,12949,12943,12938,12932,12927,12921,12916,12910,12905,12899,12894,12888,
12883,12877,12872,12866,12861,12855,12850,12844,12838,12833,12827,12822,12816,12811,12805,12799,12794,12788,12783,12777,
12772,12766,12760,12755,12749,12743,12738,12732,12727,12721,12715,12710,12704,12698,12693,12687,12681,12676,12670,12665,
12659,12653,12647,12642,12636,12630,12625,12619,12613,12608,12602,12596,12590,12585,12579,12573,12568,12562,12556,12550,
12545,12539,12533,12527,12522,12516,12510,12504,12499,12493,12487,12481,12475,12470,12464,12458,12452,12446,12441,12435,
12429,12423,12417,12411,12406,12400,12394,12388,12382,12376,12371,12365,12359,12353,12347,12341,12335,12329,12324,12318,
12312,12306,12300,12294,12288,12282,12276,12270,12264,12259,12253,12247,12241,12235,12229,12223,12217,12211,12205,12199,
12193,12187,12181,12175,12169,12163,12157,12151,12145,12139,12133,12127,12121,12115,12109,12103,12097,12091,12085,12079,
12073,12067,12061,12055,12049,12043,12037,12031,12025,12019,12012,12006,12000,11994,11988,11982,11976,11970,11964,11958,
11951,11945,11939,11933,11927,11921,11915,11909,11902,11896,11890,11884,11878,11872,11866,11859,11853,11847,11841,11835,
11829,11822,11816,11810,11804,11798,11791,11785,11779,11773,11767,11760,11754,11748,11742,11735,11729,11723,11717,11710,
11704,11698,11692,11685,11679,11673,11667,11660,11654,11648,11641,11635,11629,11623,11616,11610,11604,11597,11591,11585,
11578,11572,11566,11559,11553,11547,11540,11534,11528,11521,11515,11509,11502,11496,11490,11483,11477,11470,11464,11458,
11451,11445,11438,11432,11426,11419,11413,11406,11400,11394,11387,11381,11374,11368,11361,11355,11349,11342,11336,11329,
11323,11316,11310,11303,11297,11290,11284,11278,11271,11265,11258,11252,11245,11239,11232,11226,11219,11213,11206,11199,
11193,11186,11180,11173,11167,11160,11154,11147,11141,11134,11128,11121,11114,11108,11101,11095,11088,11082,11075,11068,
11062,11055,11049,11042,11035,11029,11022,11016,11009,11002,10996,10989,10982,10976,10969,10963,10956,10949,10943,10936,
10929,10923,10916,10909,10903,10896,10889,10883,10876,10869,10863,10856,10849,10842,10836,10829,10822,10816,10809,10802,
10796,10789,10782,10775,10769,10762,10755,10748,10742,10735,10728,10721,10715,10708,10701,10694,10688,10681,10674,10667,
10660,10654,10647,10640,10633,10626,10620,10613,10606,10599,10592,10586,10579,10572,10565,10558,10551,10545,10538,10531,
10524,10517,10510,10504,10497,10490,10483,10476,10469,10462,10455,10449,10442,10435,10428,10421,10414,10407,10400,10393,
10386,10380,10373,10366,10359,10352,10345,10338,10331,10324,10317,10310,10303,10296,10289,10282,10276,10269,10262,10255,
10248,10241,10234,10227,10220,10213,10206,10199,10192,10185,10178,10171,10164,10157,10150,10143,10136,10129,10122,10115,
10108,10101,10094,10086,10079,10072,10065,10058,10051,10044,10037,10030,10023,10016,10009,10002,9995,9988,9981,9973,
9966,9959,9952,9945,9938,9931,9924,9917,9910,9902,9895,9888,9881,9874,9867,9860,9852,9845,9838,9831,
9824,9817,9810,9802,9795,9788,9781,9774,9767,9759,9752,9745,9738,9731,9724,9716,9709,9702,9695,9688,
9680,9673,9666,9659,9651,9644,9637,9630,9623,9615,9608,9601,9594,9586,9579,9572,9565,9557,9550,9543,
9536,9528,9521,9514,9506,9499,9492,9485,9477,9470,9463,9455,9448,9441,9434,9426,9419,9412,9404,9397,
9390,9382,9375,9368,9360,9353,9346,9338,9331,9324,9316,9309,9302,9294,9287,9279,9272,9265,9257,9250,
9243,9235,9228,9220,9213,9206,9198,9191,9184,9176,9169,9161,9154,9146,9139,9132,9124,9117,9109,9102,
9095,9087,9080,9072,9065,9057,9050,9042,9035,9028,9020,9013,9005,8998,8990,8983,8975,8968,8960,8953,
8945,8938,8930,8923,8915,8908,8900,8893,8885,8878,8870,8863,8855,8848,8840,8833,8825,8818,8810,8803,
8795,8788,8780,8772,8765,8757,8750,8742,8735,8727,8720,8712,8704,8697,8689,8682,8674,8667,8659,8651,
8644,8636,8629,8621,8613,8606,8598,8591,8583,8575,8568,8560,8552,8545,8537,8530,8522,8514,8507,8499,
8491,8484,8476,8469,8461,8453,8446,8438,8430,8423,8415,8407,8400,8392,8384,8377,8369,8361,8353,8346,
8338,8330,8323,8315,8307,8300,8292,8284,8276,8269,8261,8253,8246,8238,8230,8222,8215,8207,8199,8192,
8184,8176,8168,8161,8153,8145,8137,8130,8122,8114,8106,8098,8091,8083,8075,8067,8060,8052,8044,8036,
8028,8021,8013,8005,7997,7989,7982,7974,7966,7958,7950,7943,7935,7927,7919,7911,7904,7896,7888,7880,
7872,7864,7857,7849,7841,7833,7825,7817,7809,7802,7794,7786,7778,7770,7762,7754,7746,7739,7731,7723,
7715,7707,7699,7691,7683,7676,7668,7660,7652,7644,7636,7628,7620,7612,7604,7596,7589,7581,7573,7565,
7557,7549,7541,7533,7525,7517,7509,7501,7493,7485,7477,7470,7462,7454,7446,7438,7430,7422,7414,7406,
7398,7390,7382,7374,7366,7358,7350,7342,7334,7326,7318,7310,7302,7294,7286,7278,7270,7262,7254,7246,
7238,7230,7222,7214,7206,7198,7190,7182,7174,7166,7158,7150,7142,7134,7125,7117,7109,7101,7093,7085,
7077,7069,7061,7053,7045,7037,7029,7021,7013,7005,6996,6988,6980,6972,6964,6956,6948,6940,6932,6924,
6916,6907,6899,6891,6883,6875,6867,6859,6851,6843,6834,6826,6818,6810,6802,6794,6786,6778,6769,6761,
6753,6745,6737,6729,6721,6712,6704,6696,6688,6680,6672,6663,6655,6647,6639,6631,6623,6614,6606,6598,
6590,6582,6574,6565,6557,6549,6541,6533,6524,6516,6508,6500,6492,6483,6475,6467,6459,6451,6442,6434,
6426,6418,6409,6401,6393,6385,6377,6368,6360,6352,6344,6335,6327,6319,6311,6302,6294,6286,6278,6269,
6261,6253,6245,6236,6228,6220,6212,6203,6195,6187,6178,6170,6162,6154,6145,6137,6129,6120,6112,6104,
6096,6087,6079,6071,6062,6054,6046,6037,6029,6021,6013,6004,5996,5988,5979,5971,5963,5954,5946,5938,
5929,5921,5913,5904,5896,5888,5879,5871,5863,5854,5846,5838,5829,5821,5813,5804,5796,5787,5779,5771,
5762,5754,5746,5737,5729,5721,5712,5704,5695,5687,5679,5670,5662,5654,5645,5637,5628,5620,5612,5603,
5595,5586,5578,5570,5561,5553,5544,5536,5528,5519,5511,5502,5494,5485,5477,5469,5460,5452,5443,5435,
5426,5418,5410,5401,5393,5384,5376,5367,5359,5351,5342,5334,5325,5317,5308,5300,5291,5283,5274,5266,
5258,5249,5241,5232,5224,5215,5207,5198,5190,5181,5173,5164,5156,5147,5139,5130,5122,5113,5105,5096,
5088,5079,5071,5062,5054,5045,5037,5028,5020,5011,5003,4994,4986,4977,4969,4960,4952,4943,4935,4926,
4918,4909,4901,4892,4884,4875,4867,4858,4850,4841,4832,4824,4815,4807,4798,4790,4781,4773,4764,4756,
4747,4738,4730,4721,4713,4704,4696,4687,4679,4670,4661,4653,4644,4636,4627,4619,4610,4601,4593,4584,
4576,4567,4558,4550,4541,4533,4524,4516,4507,4498,4490,4481,4473,4464,4455,4447,4438,4430,4421,4412,
4404,4395,4387,4378,4369,4361,4352,4343,4335,4326,4318,4309,4300,4292,4283,4275,4266,4257,4249,4240,
4231,4223,4214,4205,4197,4188,4180,4171,4162,4154,4145,4136,4128,4119,4110,4102,4093,4084,4076,4067,
4058,4050,4041,4032,4024,4015,4006,3998,3989,3980,3972,3963,3954,3946,3937,3928,3920,3911,3902,3894,
3885,3876,3868,3859,3850,3842,3833,3824,3816,3807,3798,3790,3781,3772,3763,3755,3746,3737,3729,3720,
3711,3703,3694,3685,3676,3668,3659,3650,3642,3633,3624,3615,3607,3598,3589,3581,3572,3563,3554,3546,
3537,3528,3519,3511,3502,3493,3485,3476,3467,3458,3450,3441,3432,3423,3415,3406,3397,3388,3380,3371,
3362,3353,3345,3336,3327,3318,3310,3301,3292,3283,3275,3266,3257,3248,3240,3231,3222,3213,3205,3196,
3187,3178,3170,3161,3152,3143,3134,3126,3117,3108,3099,3091,3082,3073,3064,3056,3047,3038,3029,3020,
3012,3003,2994,2985,2976,2968,2959,2950,2941,2933,2924,2915,2906,2897,2889,2880,2871,2862,2853,2845,
2836,2827,2818,2809,2801,2792,2783,2774,2765,2757,2748,2739,2730,2721,2712,2704,2695,2686,2677,2668,
2660,2651,2642,2633,2624,2615,2607,2598,2589,2580,2571,2563,2554,2545,2536,2527,2518,2510,2501,2492,
2483,2474,2465,2457,2448,2439,2430,2421,2412,2404,2395,2386,2377,2368,2359,2350,2342,2333,2324,2315,
2306,2297,2289,2280,2271,2262,2253,2244,2235,2227,2218,2209,2200,2191,2182,2173,2165,2156,2147,2138,
2129,2120,2111,2103,2094,2085,2076,2067,2058,2049,2041,2032,2023,2014,2005,1996,1987,1978,1970,1961,
1952,1943,1934,1925,1916,1907,1899,1890,1881,1872,1863,1854,1845,1836,1828,1819,1810,1801,1792,1783,
1774,1765,1757,1748,1739,1730,1721,1712,1703,1694,1685,1677,1668,1659,1650,1641,1632,1623,1614,1605,
1597,1588,1579,1570,1561,1552,1543,1534,1525,1516,1508,1499,1490,1481,1472,1463,1454,1445,1436,1427,
1419,1410,1401,1392,1383,1374,1365,1356,1347,1338,1330,1321,1312,1303,1294,1285,1276,1267,1258,1249,
1240,1232,1223,1214,1205,1196,1187,1178,1169,1160,1151,1142,1133,1125,1116,1107,1098,1089,1080,1071,
1062,1053,1044,1035,1026,1018,1009,1000,991,982,973,964,955,946,937,928,919,911,902,893,
884,875,866,857,848,839,830,821,812,803,794,786,777,768,759,750,741,732,723,714,
705,696,687,678,670,661,652,643,634,625,616,607,598,589,580,571,562,553,545,536,
527,518,509,500,491,482,473,464,455,446,437,428,419,411,402,393,384,375,366,357,
348,339,330,321,312,303,294,285,277,268,259,250,241,232,223,214,205,196,187,178,
169,160,151,142,134,125,116,107,98,89,80,71,62,53,44,35,26,17,8,0,0};

inline trigonometric sine(uint16_t original_angle){

    uint16_t positive_angle = (original_angle & 0b0111111111111111);
    //TODO - how to calculate the module in a better way in this architecture?
    uint16_t normalized_angle = positive_angle % (360 << 5);
    uint16_t last_angle = normalized_angle;

    //In this code, I changed an angle between 0 and 360 to an angle between 0 and 90
    if(normalized_angle > (180 << 5))
        last_angle = normalized_angle - (180 << 5);
    if(last_angle > (90 << 5))
        last_angle = (180 << 5) - last_angle;

    //TODO - check if CCES C can use bool variables
    //I want to avoid pipeline breaks, so I'll check in which quadrant the angle is, based on a division by 4
    uint8_t divided = normalized_angle / (90 << 5);
    bool negativeSin = divided>>1;
    bool negativeCos = (divided & 1) ^ negativeSin;
    negativeSin ^= original_angle >> 15;                    //cos(-theta) = cos(theta), sin(-theta) = -sin(theta)

    trigonometric to_return;
    to_return.cossine_fp    = cos_16[last_angle] | (negativeCos << 15);
    to_return.sine_fp       = cos_16[(90<<5)-last_angle] | (negativeSin << 15);       //trigonometric identity

    return to_return;
}
